{% extends 'employees/base.html' %}


{% block content %}
<h2>
 {% if form.instance.pk %}
 Редактирование сотрудника
 {% else %}
 Создание нового сотрудника
 {% endif %}
</h2>

<form method="post">
 {% csrf_token %}

 <div class="form-group">
 <h3>Основная информация</h3>
 {{ employee_form.as_p }}
 </div>

 <h3>Навыки</h3>
 <div class="skills-container">
 {% for skill_form in skill_forms %}
 <div class="skill-form">
 {{ skill_form.as_p }}
 </div>
 {% endfor %}
 </div>

 <div class="add-skill-button">
 <button type="button" class="btn btn-success" onclick="addSkillForm()">
 Добавить навык
 </button>
 </div>

 <button type="submit" class="btn btn-primary">Сохранить</button>
 <a href="{% url 'employee_list' %}" class="btn btn-secondary">Отмена</a>
</form>

<!-- Скрипт для динамического добавления форм навыков -->
<script>
let skillFormCount = {{ skill_forms.total_form_count }};

function addSkillForm() {
 const container = document.querySelector('.skills-container');
 const newForm = document.createElement('div');
 newForm.classList.add('skill-form');

 // Здесь нужно скопировать существующую форму и обновить индексы
 // Это упрощенный пример, в реальном приложении лучше использовать Django Formset
 newForm.innerHTML = `
 <div>
     <input type="hidden" name="skill_forms-TOTAL_FORMS" value="{{ skill_forms.total_form_count }}">
     <input type="hidden" name="skill_forms-INITIAL_FORMS" value="{{ skill_forms.initial_form_count }}">
     <input type="hidden" name="skill_forms-MIN_NUM_FORMS" value="0">
     <input type="hidden" name="skill_forms-MAX_NUM_FORMS" value="1000">
     <select name="skill_forms-{{ skillFormCount }}-skill">
         {% for skill in skills %}
         <option value="{{ skill.id }}">{{ skill.name }}</option>
         {% endfor %}
     </select>
     <input type="number" name="skill_forms-{{ skillFormCount }}-level" min="1" max="10">
 </div>
 `;

 container.appendChild(newForm);
 skillFormCount++;
}
</script>
{% endblock %}